@page "/question"
@using DC.Models
@using MudBlazor

@inject AppDbContext appDbContext
@inject IDialogService dialogService
@inject ISnackbar sb

@rendermode InteractiveServer

<PageTitle>Question</PageTitle>

<AuthorizeView>
    <NotAuthorized>
        <MudText Typo="Typo.h6">You are not authorized to view this page.</MudText>
    </NotAuthorized>
    <Authorized>
        <MudTabs Elevation="0" ApplyEffectsToContainer="true" PanelClass="pa-6" ActivePanelIndex="activeIndex" ActivePanelIndexChanged="HandleTabChanged">
            <MudTabPanel Text="Choose/Create Question" Icon="@Icons.Material.Filled.QuestionMark">
                <EditForm Context="cellContext" Model="@this" OnValidSubmit="@InsertQuestion">
                    <DataAnnotationsValidator />
                    <MudGrid Spacing="3" Justify="Justify.Center" AlignItems="AlignItems.Center">
                        <MudItem xs="14" sm="6">
                            <MudTextField Value="@_searchString" ValueChanged="@((string val) => OnSearchInput(val))" T="string" Label="New Question / Search" HelperText="Type to search or add new question" HelperTextOnFocus="true" Variant="Variant.Outlined" FullWidth="true" TextUpdateSuppression="false" Immediate="true" DebounceInterval="300" @onkeydown="@OnKeyDown" Clearable="true" />
                        </MudItem>
                        <MudItem xs="14" sm="1" Style="text-align: center;" Class="custom-button">
                            <MudButton Variant="Variant.Filled" Size="Size.Medium" EndIcon="@Icons.Material.Filled.Send" Color="Color.Primary" OnClick="@(() => InsertQuestion())">Add</MudButton>
                        </MudItem>
                    </MudGrid>
                </EditForm>

                <MudDataGrid T="QuestionModel" Items="@questions" SortMode="SortMode.Single" QuickFilter="@_quickFilter" Elevation="0" Class="custom-mudtable no-scroll pa6">
                    <Columns>
                        <PropertyColumn Property="x => x.Id" Title="ID" InitialDirection="SortDirection.Descending" Sortable="true" />
                        <PropertyColumn Property="x => x.QuestionContext" Title="Question" />
                        <TemplateColumn CellClass="d-flex justify-end" Width="30px">
                            <CellTemplate Context="cellContext">
                                <MudStack Row>
                                    <MudIconButton Icon="@Icons.Material.Filled.Edit" Color="Color.Primary" Size="Size.Small" OnClick="@(() => OpenEditDialog(cellContext.Item))" />
                                    <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Secondary" Size="Size.Small" OnClick="@(() => DeleteQuestion(cellContext.Item))" />
                                    <MudIconButton Label="Clone" Icon="@Icons.Material.Filled.ContentCopy" Color="Color.Info" Size="Size.Small" OnClick="@(() => CloneQuestion(cellContext.Item))" />
                                </MudStack>
                            </CellTemplate>
                        </TemplateColumn>
                    </Columns>
                    <PagerContent>
                        <MudDataGridPager T="QuestionModel" />
                    </PagerContent>
                </MudDataGrid>

                <MudText Typo="Typo.body2">Questions in List: @questions.Count</MudText>
            </MudTabPanel>
            <MudTabPanel Text="Choose Answers" Icon="@Icons.Material.Filled.QuestionAnswer">

            </MudTabPanel>
        </MudTabs>
    </Authorized>
</AuthorizeView>

<style>
    .custom-mudtable .mud-table-container {
        overflow-y: unset !important;
    }

    .custom-button {
        flex-grow: 0;
        align-content: space-around;
        padding-bottom: 15px;
    }
</style>