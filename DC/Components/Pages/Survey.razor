@page "/survey"

@inject AppDbContext appDbContext
@inject IDialogService dialogService


@rendermode InteractiveServer

<PageTitle>Survey</PageTitle>

<MudTabs Elevation="0" ApplyEffectsToContainer="true" PanelClass="pa-6" ActivePanelIndex="activeIndex" ActivePanelIndexChanged="HandleTabChanged">
  <MudTabPanel Text="Choose/Create Survey" Icon="@Icons.Material.Filled.EventNote">
    <MudCard>
      <MudCardContent>
        <MudText Typo="Typo.h3">Choose an existing survey or create a new one.</MudText>
        <MudText Typo="Typo.body2">Selected Survey: @selectedSurvey?.Id</MudText>
      </MudCardContent>
      <MudCardActions>
        <MudStack Spacing="2" Row="true">
          <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="OpenSurveyDialog">Create New Survey</MudButton>
        </MudStack>
      </MudCardActions>
    </MudCard>
    <MudDataGrid T="SurveyModel" Items="@surveys" SortMode="SortMode.Multiple" Filterable="true" QuickFilter="@_quickFilter">
      <ToolBarContent>
        <MudText Typo="Typo.h6">Surveys</MudText>
        <MudSpacer />
        <MudTextField @bind-Value="_searchString" Placeholder="Search" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
      </ToolBarContent>
      <Columns>
        <PropertyColumn T="SurveyModel" TProperty="int" Property="x => x.Id" Title="ID" />
        <PropertyColumn T="SurveyModel" TProperty="DateTime" Property="x => x.StartDate" Title="Start Date" Format="dd/MM/yyyy" />
        <PropertyColumn T="SurveyModel" TProperty="DateTime" Property="x => x.EndDate" Title="End Date" Format="dd/MM/yyyy" />
        <PropertyColumn T="SurveyModel" TProperty="DateTime" Property="x => x.CreatedDate" Title="Created Date" Format="dd/MM/yyyy HH:mm" />
        <PropertyColumn T="SurveyModel" TProperty="bool">
          <CellTemplate>
            <MudFab Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" OnClick="@(() => SelectItem(context.Item))" />
          </CellTemplate>
        </PropertyColumn>
      </Columns>
      <PagerContent>
        <MudDataGridPager T="SurveyModel" />
      </PagerContent>
    </MudDataGrid>
  </MudTabPanel>
  <MudTabPanel Text="Choose Question" Icon="@Icons.Material.Filled.QuestionMark">
    <MudCard>
      <MudCardContent>
        <MudText Typo="Typo.h6">Choose Question</MudText>
        <MudText Typo="Typo.body2">Choose a question from the list below.</MudText>
      </MudCardContent>
      <MudCardActions>
        <MudStack Spacing="2" Row="true">
          <MudButton Color="Color.Primary" Variant="Variant.Filled">Choose Question</MudButton>
        </MudStack>
      </MudCardActions>
    </MudCard>
  </MudTabPanel>
</MudTabs>